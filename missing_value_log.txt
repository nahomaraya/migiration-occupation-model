Loading data...
Initial shape: (77784358, 82)

==================================================
STEP 1: FILTERING TO LABOR FORCE
==================================================

labforce value counts (before filtering):
shape: (3, 2)
┌──────────┬──────────┐
│ labforce ┆ len      │
│ ---      ┆ ---      │
│ i8       ┆ u32      │
╞══════════╪══════════╡
│ 0        ┆ 15257802 │
│ 1        ┆ 24337653 │
│ 2        ┆ 38188903 │
└──────────┴──────────┘

Rows before filter: 77,784,358
Rows after filter: 35,805,107
Rows removed: 41,979,251 (54.0%)

==================================================
STEP 2: STRUCTURAL MISSINGNESS - MIGRATION VARIABLES
==================================================

[A] Processing bpl (Birthplace)...
  US-born (bpl <= 120): 30,594,251
  Foreign-born (bpl > 120): 5,210,856
  ✓ Created: is_immigrant

[B] Processing yrimmig → years_in_us...
  ✓ Created: years_in_us

[C] Processing citizen → citizenship_status...
  ✓ Created: citizenship_status
    0=Native, 1=Naturalized, 2=Non-Citizen
shape: (3, 2)
┌────────────────────┬──────────┐
│ citizenship_status ┆ len      │
│ ---                ┆ ---      │
│ i32                ┆ u32      │
╞════════════════════╪══════════╡
│ 0                  ┆ 30931133 │
│ 1                  ┆ 2494578  │
│ 2                  ┆ 2379396  │
└────────────────────┴──────────┘

[D] Processing yrnatur (Year Naturalized)...
  Nulls in yrnatur: 12,753,204
  ✓ yrnatur processed: 0 for natives/non-citizens, actual year for naturalized

[E] Handling 16 other migration variables...
  ✓ migrate1: 6,443,292 nulls → sentinel (-1) + indicator
  ✓ migrate1d: 6,443,292 nulls → sentinel (-1) + indicator
  ✓ migplac1: 6,443,292 nulls → sentinel (-1) + indicator
  ✓ migcounty1: 8,626,095 nulls → sentinel (-1) + indicator
  ✓ migmet131: 8,626,095 nulls → sentinel (-1) + indicator

==================================================
STEP 3: EDUCATION VARIABLES (LOGICAL FILLING)
==================================================

Processing 6 education variables...
  ✓ degfield: 14,188,183 nulls → 0 (No Degree) + indicator
  ✓ degfieldd: 14,188,183 nulls → 0 (No Degree) + indicator

==================================================
STEP 4-6: CATEGORICAL VARIABLES
==================================================

Processing 29 categorical variables...
  ✓ countyicp: 2,182,803 nulls → sentinel (-1) + indicator
  ✓ city: 2,182,803 nulls → sentinel (-1) + indicator
  ✓ cityerr: 2,182,803 nulls → sentinel (-1) + indicator
  ✓ wrklstwk: 6,443,292 nulls → sentinel (-1) + indicator

==================================================
STEP 7: WORK/TRANSPORT VARIABLES
==================================================

Processing 3 work/transport variables...

==================================================
STEP 8: NUMERIC VARIABLES (MEDIAN IMPUTATION)
==================================================

Processing 8 numeric variables...
  ✓ citypop: 2,182,803 nulls → median (0.0) + indicator

==================================================
FINAL VERIFICATION
==================================================

Total remaining nulls across all columns: 8,626,095

Columns still with nulls:
  cbserial: 8,626,095

✓ Missingness indicators created: 13
✓ Engineered migration features: 3

Final shape: (35805107, 98)
Final memory: 8651.2 MB

Saving to ipums_data_processed.parquet...
✓ Saved successfully

==================================================
SAMPLE OF PROCESSED DATA
==================================================
shape: (10, 7)
┌──────────────┬─────────────┬────────────────────┬─────┬──────┬─────┬──────┐
│ is_immigrant ┆ years_in_us ┆ citizenship_status ┆ age ┆ educ ┆ sex ┆ race │
│ ---          ┆ ---         ┆ ---                ┆ --- ┆ ---  ┆ --- ┆ ---  │
│ i8           ┆ i16         ┆ i32                ┆ i8  ┆ i8   ┆ i8  ┆ i8   │
╞══════════════╪═════════════╪════════════════════╪═════╪══════╪═════╪══════╡
│ 0            ┆ 43          ┆ 0                  ┆ 43  ┆ 11   ┆ 1   ┆ 1    │
│ 0            ┆ 46          ┆ 0                  ┆ 46  ┆ 10   ┆ 2   ┆ 1    │
│ 0            ┆ 62          ┆ 0                  ┆ 62  ┆ 11   ┆ 1   ┆ 1    │
│ 0            ┆ 51          ┆ 0                  ┆ 51  ┆ 8    ┆ 2   ┆ 1    │
│ 0            ┆ 38          ┆ 0                  ┆ 38  ┆ 5    ┆ 1   ┆ 1    │
│ 0            ┆ 19          ┆ 0                  ┆ 19  ┆ 7    ┆ 1   ┆ 1    │
│ 1            ┆ 6           ┆ 2                  ┆ 27  ┆ 11   ┆ 2   ┆ 1    │
│ 0            ┆ 43          ┆ 0                  ┆ 43  ┆ 6    ┆ 1   ┆ 8    │
│ 0            ┆ 39          ┆ 0                  ┆ 39  ┆ 6    ┆ 2   ┆ 1    │
│ 0            ┆ 53          ┆ 0                  ┆ 53  ┆ 11   ┆ 2   ┆ 1    │
└──────────────┴─────────────┴────────────────────┴─────┴──────┴─────┴──────┘

==================================================
TARGET VALIDATION
==================================================
Rows with OCCSCORE = 0: 0

CLASSWKR Distribution (Target):
shape: (2, 2)
┌──────────┬──────────┐
│ classwkr ┆ len      │
│ ---      ┆ ---      │
│ i8       ┆ u32      │
╞══════════╪══════════╡
│ 1        ┆ 3757771  │
│ 2        ┆ 32047336 │
└──────────┴──────────┘

Process finished with exit code 0